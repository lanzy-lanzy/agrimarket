{% extends 'base.html' %}
{% load currency_filters %}

{% block title %}{{ item.name }} - AgriMarket{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="flex flex-col md:flex-row">
        <div class="md:w-1/2">
            {% if item.image %}
            <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-full h-96 object-cover">
            {% else %}
            <div class="w-full h-96 bg-gray-200 flex items-center justify-center">
                <span class="text-gray-500">No image available</span>
            </div>
            {% endif %}
        </div>
        <div class="md:w-1/2 p-8">
            <div class="mb-4">
                <h1 class="text-3xl font-bold mb-2">{{ item.name }}</h1>
                <div class="flex items-center mb-4">
                    <span class="bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm">{{ item.get_category_display }}</span>
                    <span class="mx-2">â€¢</span>
                    <span class="text-gray-500 text-sm">Listed by {{ item.seller.username }}</span>
                </div>
                <div class="text-2xl font-bold text-green-700 mb-4">{{ item.price|currency }}</div>
                <div class="prose max-w-none mb-6">
                    <p>{{ item.description }}</p>
                </div>

                {% if user.is_authenticated and user.is_buyer %}
                <div class="flex space-x-4">
                    <button hx-post="{% url 'add_to_cart' item.id %}"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            hx-swap="none"
                            hx-trigger="click"
                            class="bg-green-700 text-white px-6 py-3 rounded-md hover:bg-green-800 transition flex items-center"
                            x-data="{}"
                            @htmx:after-request="$dispatch('show-notification', {message: '{{ item.name }} added to cart'})">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        Add to Cart
                    </button>
                    <a href="{% url 'view_cart' %}" class="border border-green-700 text-green-700 px-6 py-3 rounded-md hover:bg-green-50 transition">View Cart</a>
                </div>
                {% elif not user.is_authenticated %}
                <div class="bg-gray-100 p-4 rounded-md">
                    <p class="text-gray-700">Please <a href="{% url 'login' %}" class="text-green-700 hover:underline">login</a> or <a href="{% url 'register' %}" class="text-green-700 hover:underline">register</a> as a buyer to purchase this item.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Notification -->
<div x-data="{ show: false, message: '' }"
     @show-notification.window="show = true; message = $event.detail.message; setTimeout(() => show = false, 3000)"
     x-show="show"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 transform translate-y-2"
     x-transition:enter-end="opacity-100 transform translate-y-0"
     x-transition:leave="transition ease-in duration-300"
     x-transition:leave-start="opacity-100 transform translate-y-0"
     x-transition:leave-end="opacity-0 transform translate-y-2"
     class="fixed bottom-4 right-4 bg-green-700 text-white px-6 py-3 rounded-md shadow-lg"
     style="display: none;">
    <div class="flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span x-text="message"></span>
    </div>
</div>
{% endblock %}
